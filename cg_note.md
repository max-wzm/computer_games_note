# 机器博弈阅读笔记

## 引言

机器博弈：Computer Games.

CG相关组织（负责博弈竞赛和学术交流）：

- ICGA
- 中国人工智能学会-机器博弈专业委员会

CG发展历史：

- 里程碑：1997年IBM深蓝战胜棋王
- 重要人物：
  - 陈志行教授：电脑围棋先行者
  - 许峰雄博士：组织深蓝课题组
- 国内发展：姗姗来迟但发展迅速。包括多种博弈竞赛、学术研究。

CG具有强大的生命力与产业化前景。可以应用到面对决策优化的各种场合，包括了经济、政治、军事、反恐、治霾和日常生活中无所不在的内容。

## 机器博弈的发展状况

### 机器博弈历史

- 1928年，冯诺依曼提出极大极小值定理，证明了博弈论的基本原理 。
- 1944年，冯诺依曼和摩根斯特恩将博弈论系统应用于经济领域，奠定了机器博弈研究的理论基础。
- 从上个世纪50年代开始，许多数学家和计算机学家都为计算机博弈做出了非常重要的贡献。这其中包括了多种棋类游戏的程序化博弈。
- 上个世纪八九十年代，随着计算机硬件与软件水平的发展，计算机在博弈类比赛当中逐渐反超人类。
- 步入人工智能时代之后，谷歌、腾讯、百度等企业都在机器博弈的领域当中取得了很好的成果，开发出了一些具有较高智能水平的产品，如AlphaGo、绝艺等。

### 研究现状

机器博弈是人工智能的「果蝇」。

#### 国外研究现状

早期研究：
- 建立有效、快速的评价函数和方法
- 在博弈树上更准确地找出最优解 -> 搜索算法

随后的博弈技术：基于计算机博弈搜索和评估
- 极大极小搜索
- 负极大值搜索
- Alpha-Beta剪枝
- 并行搜索算法

新的突破：深度学习
- 基于 **深度信念网络DBN** 非监督的逐层贪心训练算法
- 与并行计算、人工神经网络的融合

机器博弈产品：
- **AlphaGo**：完备信息博弈的代表，DL与CG的结合。
  - 棋感直觉-深度学习网络🛜：通过3000w棋局学习得到。
    - 落子棋感-快速走棋网络🛜
    - 胜负棋感-策略网络🛜：不断自对弈
  - 搜索验证-蒙特卡洛搜索树🌲
- **Libratus**：德州扑克博弈，不完备信息博弈的代表。
  - 赛前Nash Eq近似：
    - 抽取博弈信息（如针对某一手牌的战略），应用强化学习。
    - 蒙特卡洛反事实遗憾最小化：自己学习。
  - 残局解算：
    - 自底向上构造博弈树🌲
    - 使用蒙特卡洛方法，更新上面的策略：能在比赛中学到东西。
  - 持续自我强化：
    - 发现赛中的问题，进行自我强化，得到更好的Nash eq。

#### 国内研究现状

国内计算机博弈研究相对起步较晚，近几年，学者们结合棋牌各自特点，针对计算机博弈搜索、评估与优化等方面开展了深入研究：

- 对于局面估值问题：
  - 提出结合时间差分算法和反向传播神经网络，设计一种局面估值算法实现评估函数参数的自动调整;
- 针对六子棋：
  - 东北大学徐长明：局面表示等关键技术
  - 重庆理工大学张小川教授：应用遗传算法优化评估函数
  - 安徽大学李学俊教授等：基于局部“路”扫描方式的博弈树生成算法;
- 针对中国象棋：
  - 东北大学王骄教授：计算机博弈开局库、循环判定规则、评估函数参数组的自动调整和优化
- 针对苏拉卡尔塔棋：
  - 北京信息科技大学李淑琴教授等：根据棋子的数量、移动范围等不同参数，对局面评估函数进行了研究;
  - 辽宁石油化工大学张利群教授：网络博弈平台吃子算法;
- 针对亚马逊棋：
  - 沈阳航空航天大学邱虹坤等：对搜索算法进行了分析
  - 李淑琴教授：根据特征权重值给出一个分阶段的评估函数;
- 中央民族大学李霞丽和吴立成教授：提出一种围棋多模态算法，及基于小样本的藏棋博弈算法;
- 针对德州扑克等博弈系统：
  - 哈尔滨工业大学王轩教授团队：非完备信息机器博弈中风险及对手模型的研究。


### 产业现状

### 问题与展望

## 博弈的复杂度

### 概述

博弈的复杂度包括了两个方面：
- 状态复杂度
- 博弈树复杂度

### 状态复杂度

**博弈过程的局面**称之为状态。状态复杂度指从初始局面出发，产生所有合法局面的总和。

换句话说，我们看一颗博弈树🌲，那它就有节点。那么状态复杂度指的就是，这样的结点可能有多少种。

举一个例子，假设有这样一个假想游戏：

> 4x4的棋盘格，黑白双方轮流下子，先把棋盘占满的赢。

在16个格子当中，每个格子可能有空白、黑子、白子三种情况。则可能有 $3^{16}= 43,046,721$ 种局面，或者说博弈树有这么多种节点。这个例子的状态复杂度就是 $3^{16}$

当然，在真正的游戏当中，具体的规则可能会让某些局面无效。例如在白皮书中举的亚马逊棋、苏拉卡尔塔棋的例子。

### 博弈树复杂度

**博弈树**是一颗根在上叶在下的树，分若干层，每一层代表某一走棋方可以走出的合法局面。

对于只添子的游戏（如五子棋），树的各个节点互不相同；对于存在移动棋子的游戏，树中可能存在相同的节点（局面）。

**博弈树搜索算法**：常用于完备信息的博弈系统（博弈树是确定的）。通过估值函数评价各个局面（非叶节点）的优劣，找到最佳走法。

**解决树**：得到理论解所需展开的最小搜索树。

**博弈树复杂度**是指从初始局面开始，其解决树的所有叶子节点的总和。

估算方法：
- 平均分支因子 (如:围棋、中国象棋、亚马逊棋、六子棋等)
- 蛮力搜索 (如:tic-tac-toe)

#### Case Study：六子棋

六子棋的平均博弈深度为30层。

第1步有361点可下，第i步有 $C_{364-2i}^2$ 个点可以下。棋盘上连6的局面有952种情况。从第6层开始，产生的节点数要扣除连6。于是

$$
\begin{align*}
    countNodes(6) = 361\times C_{360}^2\times\dots\times C_{352}^2-952\\ 
    countNodes(n) = countNodes(n-1)\times C_{364-2n}^2-952
\end{align*}
$$

这样算出来大概是上限 $10^{145}$.

### 博弈问题的计算复杂性

## 机器博弈的典型技术

博弈搜索算法：
- 搜索范围：
  - 穷尽搜索
  - 裁剪搜索

### 穷尽搜索

- 极大极小搜索
- 负极大值搜索：在极大极小搜索上的改进，把极小节点值(返回给搜索引擎的局面估值)取绝对值，这样每次递归都选取最大值。

### 裁剪搜索

aka 剪枝算法。

- Alpha-Beta剪枝：在极大极小搜索上的改进算法，是其他剪枝算法的基础。多数采用负极大值形式的AB搜索算法。可能需要调整树的结构，对搜索结点排序，确保迟早剪枝。
- 渴望搜索：在AB搜索的基础上，缩小搜索范围。从一开始使用小窗口，在搜索之初进行大量剪枝。通常与遍历深化技术结合，提高性能。 
- MTD(f)搜索：不断应用零窗口的AB搜索，缩小上下界。简单高效，表现出色。
- 其他优化算法。
  - 在🌲的同层结点当中，用BFS，接力空窗探测。avg搜索效率高于mtdf。

通常，裁剪算法需要与置换表技术结合，减少树的规模，提高搜索效率。

### 启发式算法

启发（Heuristic）指通过排序让AB剪枝的搜索树尽量接近最小树，优先搜索好的着法。通常有：

- 置换表启发
  置换表是一个大的直接访问表，存储已经搜索过的结点（子树）的结果。类似于记忆化搜索。常用Hash表或者ZobristHash技术实现。
  - 优点：提高搜索效率
  - 缺点：当树的深度很大，对内存空间的要求巨大。通常为置换表分配有限大小，采用散列方式管理存取。
  置换表启发是将置换表与AB剪枝结合的产物，如在中国象棋等棋种中，用来增强搜索效率。
- 历史启发 HH
  也是基于ABS对节点排列顺序敏感的特点，维护着法的历史，每当遇到好的着法，就给其历史得分一个增量，提高其优先级。
- 杀手启发 KH
  viewed as 历史启发的特例。同层引发剪枝最多的节点为killer。下次搜索到同一层时，优先搜索杀手。
  杀手启发可以对着法进行动态重排序，提高置换表的使用效率。

研究表明，HH与置换表结合可以大幅减少博弈树空间。在残局当中应用KH可以明显节约时间。
